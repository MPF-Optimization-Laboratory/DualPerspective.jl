---
title: "KL-Regularized Least Squares"
subtitle: "Phyics data"
authors:
  - Nicholas Barnield
  - Michael P. Friedlander
  - Tim Hoheisel
date: last-modified
format: typst
execute:
    cache: true
---

```{julia}
#| echo: false
#| code-fold: true
#| code-summary: "Import packages" 
using Revise
using KLLS
using NPZ
using Plots
using Printf
using UnPack
```


## Load physics data

The file `PhysicsData.npz` contains the matrix and vectors generated by the script `PhysicsData.jl`, where we get the output from `generate_data`:

- `A` is the first output argument `A`
- `b` is the second output argument `data0`
- `x0` is the third input argument, which seems to be the ground truth distribution.

```{julia}
#| output: false 
data = npzread("PhysicsData.npz", ["A", "b", "x0"])
@unpack A, b, x0 = data
klprob = KLLSData(A, b)
```

## Solve over a range of regularization parameters 

Solve the problem for a range of logarithmically spaced regularization parameters $\lambda$ between $10^{-8}$ and $1$.

```{julia}
stats = map(exp10.(range(-8, stop=0, length=5))) do λ
          klprob.λ = λ
          p, y, stats = newtoncg(klprob)
          (λ=λ, p=p, iters=stats.iter, ∇dNrm=stats.dual_feas)
        end;
```

# Comparison to ground truth
```{julia}
lab = hcat([@sprintf("λ = %6.0e", λ) for λ in getfield.(stats, :λ)]...)
default(lw=2, title="true and recovered distributions")
plot(getfield.(stats, :p), lab = lab)
plot!(x0, label="ground truth")
```

The curve corresponding to the smallest parameter λ (1e-8) best approximates the modes of the ground-truth distribution, but smaller values of λ don't make help.

These tests use a uniform prior. Does the data generator make a prior available? If so, this could be used to improve the results.